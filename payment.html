<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×©×œ×•× - ××˜×‘×— ×œ×•×œ×•</title>
    <meta name="description" content="×”×©×œ×™××• ××ª ×”×ª×©×œ×•× - ××˜×‘×— ×œ×•×œ×•">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
</head>
<body>
    <!-- Header -->
    <header id="header">
        <div class="container">
            <div class="logo">
                <h1>ğŸœ ××˜×‘×— ×œ×•×œ×•</h1>
                <span>×”××˜×‘×— ×”×¡×™× ×™ ×”×˜×•×‘ ×‘×™×¨×•×©×œ×™×</span>
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="index.html">×‘×™×ª</a></li>
                    <li><a href="menu.html">×”×ª×¤×¨×™×˜</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="order-progress">
        <div class="container">
            <div class="progress-steps">
                <div class="step completed">
                    <div class="step-number">1</div>
                    <span>×¢×’×œ×”</span>
                </div>
                <div class="step completed">
                    <div class="step-number">2</div>
                    <span>×¤×¨×˜×™×</span>
                </div>
                <div class="step active">
                    <div class="step-number">3</div>
                    <span>×ª×©×œ×•×</span>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <span>××™×©×•×¨</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Section -->
    <section class="payment-section">
        <div class="container">
            <div class="payment-content">
                <!-- Payment Methods -->
                <div class="payment-methods">
                    <h2>ğŸ’³ ××¤×©×¨×•×™×•×ª ×ª×©×œ×•×</h2>
                    
                    <div class="payment-options">
                        <!-- Cash Payment -->
                        <div class="payment-method" data-method="cash">
                            <div class="payment-header">
                                <input type="radio" name="payment-method" value="cash" id="payment-cash">
                                <label for="payment-cash">
                                    <div class="payment-icon">ğŸ’°</div>
                                    <div class="payment-info">
                                        <h3>××–×•××Ÿ</h3>
                                        <p>×ª×©×œ×•× ×‘××–×•××Ÿ ×‘×¢×ª ×”××©×œ×•×—/××™×¡×•×£</p>
                                    </div>
                                </label>
                            </div>
                            <div class="payment-details" style="display:none;">
                                <div class="cash-info">
                                    <p>âœ… ××™×Ÿ ×¢××œ×•×ª × ×•×¡×¤×•×ª</p>
                                    <p>âœ… ×ª×©×œ×•× × ×•×— ×•×××•×‘×˜×—</p>
                                    <p>âš ï¸ ×× × ×”×›×™× ×• ×¡×›×•× ××“×•×™×§ ××• ×§×¨×•×‘ ×œ×¡×›×•× ×”×¡×•×¤×™</p>
                                </div>
                            </div>
                        </div>

                        <!-- Bit Payment -->
                        <div class="payment-method" data-method="bit">
                            <div class="payment-header">
                                <input type="radio" name="payment-method" value="bit" id="payment-bit">
                                <label for="payment-bit">
                                    <div class="payment-icon">ğŸ“±</div>
                                    <div class="payment-info">
                                        <h3>Bit</h3>
                                        <p>×ª×©×œ×•× ××”×™×¨ ×•×‘×˜×•×— ×“×¨×š ××¤×œ×™×§×¦×™×™×ª Bit</p>
                                    </div>
                                </label>
                            </div>
                            <div class="payment-details" style="display:none;">
                                <div class="bit-info">
                                    <p>âœ… ×ª×©×œ×•× ××™×™×“×™ ×•×××•×‘×˜×—</p>
                                    <p>âœ… ××™×©×•×¨ ×”×–×× ×” ××™×™×“×™</p>
                                    <p>ğŸ’¡ ×ª×•×¢×‘×¨×• ×œ××¤×œ×™×§×¦×™×™×ª Bit ×œ×”×©×œ××ª ×”×ª×©×œ×•×</p>
                                    <div class="bit-qr" id="bit-qr" style="display:none;">
                                        <p>ğŸ“± ×¡×¨×§×• ××ª ×”×§×•×“ ××• ×œ×—×¦×• ×¢×œ ×”×§×™×©×•×¨:</p>
                                        <div class="qr-placeholder">QR Code</div>
                                        <a href="https://www.bitpay.co.il/app/me/C822FDFE-1C69-4F92-B57B-09635D465B9D" 
                                           target="_blank" class="btn-primary">×¤×ª×— ×‘××¤×œ×™×§×¦×™×™×ª Bit</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PayBox Payment -->
                        <div class="payment-method" data-method="paybox">
                            <div class="payment-header">
                                <input type="radio" name="payment-method" value="paybox" id="payment-paybox">
                                <label for="payment-paybox">
                                    <div class="payment-icon">ğŸ’³</div>
                                    <div class="payment-info">
                                        <h3>PayBox</h3>
                                        <p>×ª×©×œ×•× ×‘×›×¨×˜×™×¡ ××©×¨××™ ×“×¨×š PayBox</p>
                                    </div>
                                </label>
                            </div>
                            <div class="payment-details" style="display:none;">
                                <div class="paybox-info">
                                    <p>âœ… ×ª××™×›×” ×‘×›×œ ×›×¨×˜×™×¡×™ ×”××©×¨××™</p>
                                    <p>âœ… ×”×’× ×” ××œ××” ×¢×œ ×¤×¨×˜×™ ×”×ª×©×œ×•×</p>
                                    <p>âœ… ××¤×©×¨×•×ª ×œ×ª×©×œ×•× ×‘×ª×©×œ×•××™×</p>
                                    <div class="paybox-link" id="paybox-link" style="display:none;">
                                        <a href="https://link.payboxapp.com/Hh5KZaqQc1Jz93Zv7" 
                                           target="_blank" class="btn-primary">×”××©×š ×œ×ª×©×œ×•× PayBox</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Confirmation -->
                    <div class="payment-confirmation" id="payment-confirmation" style="display:none;">
                        <h3>âœ… ××™×©×•×¨ ×”×–×× ×”</h3>
                        <div class="confirmation-content">
                            <p>×œ××—×¨ ×”×©×œ××ª ×”×ª×©×œ×•×, ×”×”×–×× ×” ×ª×™×©×œ×— ××•×˜×•××˜×™×ª:</p>
                            <ul>
                                <li>ğŸ“± WhatsApp ×œ××˜×‘×—</li>
                                <li>ğŸ“§ ××™×©×•×¨ ×‘×“×•×"×œ</li>
                                <li>ğŸ’Œ SMS ××™×©×•×¨</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="payment-actions">
                        <button onclick="goBackToOrder()" class="btn-secondary">×—×–×•×¨ ×œ×¤×¨×˜×™×</button>
                        <button onclick="processPayment()" class="btn-primary" id="complete-order-btn" disabled>
                            ×”×©×œ× ×”×–×× ×”
                        </button>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="payment-summary">
                    <div class="summary-card">
                        <h3>ğŸ“‹ ×¡×™×›×•× ×¡×•×¤×™</h3>
                        
                        <!-- Customer Info -->
                        <div class="customer-summary" id="customer-summary">
                            <!-- Customer details will be populated here -->
                        </div>
                        
                        <!-- Order Items -->
                        <div class="order-items-summary" id="order-items-summary">
                            <!-- Order items will be populated here -->
                        </div>
                        
                        <!-- Final Totals -->
                        <div class="final-totals">
                            <div class="total-line">
                                <span>×¡×›×•× ×¤×¨×™×˜×™×:</span>
                                <span id="final-subtotal">â‚ª0.00</span>
                            </div>
                            <div class="total-line vip-discount" style="display:none;">
                                <span>×”× ×—×ª VIP (15%):</span>
                                <span id="final-vip-discount">-â‚ª0.00</span>
                            </div>
                            <div class="total-line">
                                <span id="final-delivery-label">×“××™ ××©×œ×•×—:</span>
                                <span id="final-delivery-fee">â‚ª0.00</span>
                            </div>
                            <div class="total-line final">
                                <span><strong>×¡×”"×› ×œ×ª×©×œ×•×:</strong></span>
                                <span id="final-total"><strong>â‚ª0.00</strong></span>
                            </div>
                        </div>
                        
                        <!-- Estimated Delivery -->
                        <div class="delivery-summary" id="delivery-summary">
                            <!-- Delivery details will be populated here -->
                        </div>
                        
                        <!-- VIP Benefits -->
                        <div class="vip-summary" id="vip-summary" style="display:none;">
                            <div class="vip-benefits">
                                <h4>ğŸ‘‘ ×”×˜×‘×•×ª VIP</h4>
                                <p>âœ… ×”× ×—×ª 15% ×”×•×¤×¢×œ×”</p>
                                <p>âœ… ××©×œ×•×— ×—×™× × ×¤×¢×™×œ</p>
                                <p>âœ… × ×§×•×“×•×ª ×œ×•×™××œ×™×˜×™ ×›×¤×•×œ×•×ª</p>
                            </div>
                        </div>
                        
                        <!-- Contact Support -->
                        <div class="payment-support">
                            <h4>ğŸ’¡ ×¦×¨×™×›×™× ×¢×–×¨×”?</h4>
                            <div class="support-options">
                                <a href="tel:052-520-1978" class="support-link">
                                    ğŸ“ 052-520-1978
                                </a>
                                <a href="https://wa.me/972525201978" class="support-link">
                                    ğŸ’¬ WhatsApp
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Payment Processing Modal -->
    <div id="payment-processing-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="processing-content">
                <div class="processing-icon">ğŸ”„</div>
                <h3>××¢×‘×“ ×”×–×× ×”...</h3>
                <p>×× × ×”××ª×™× ×•, ×× ×• ××¢×‘×“×™× ××ª ×”×”×–×× ×” ×©×œ×›×</p>
                <div class="processing-steps">
                    <div class="step-item" id="step-validate">âœ… ×‘×“×™×§×ª ×¤×¨×˜×™×</div>
                    <div class="step-item" id="step-payment">â³ ×¢×™×‘×•×“ ×ª×©×œ×•×</div>
                    <div class="step-item" id="step-confirm">â³ ×©×œ×™×—×ª ××™×©×•×¨</div>
                    <div class="step-item" id="step-complete">â³ ×”×©×œ××ª ×”×–×× ×”</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 ××˜×‘×— ×œ×•×œ×• - ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</p>
        </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/main.js"></script>
    <script src="js/payment.js"></script>
    <script>
        let orderDetails = {};
        
        document.addEventListener('DOMContentLoaded', () => {
            initializePaymentPage();
        });

        function initializePaymentPage() {
            loadOrderDetails();
            setupPaymentMethods();
            populateOrderSummary();
            validatePaymentAccess();
        }

        function loadOrderDetails() {
            orderDetails = Utils.loadFromStorage('orderDetails', null);
            if (!orderDetails) {
                // Redirect back if no order details
                Utils.showNotification('×œ× × ××¦××• ×¤×¨×˜×™ ×”×–×× ×”', 'error');
                setTimeout(() => window.location.href = 'order.html', 2000);
                return;
            }
        }

        function setupPaymentMethods() {
            const paymentMethods = document.querySelectorAll('input[name="payment-method"]');
            const completeBtn = document.getElementById('complete-order-btn');
            
            paymentMethods.forEach(method => {
                method.addEventListener('change', () => {
                    // Hide all payment details
                    document.querySelectorAll('.payment-details').forEach(detail => {
                        detail.style.display = 'none';
                    });
                    
                    // Show selected payment details
                    const selectedMethod = method.closest('.payment-method');
                    const details = selectedMethod.querySelector('.payment-details');
                    if (details) {
                        details.style.display = 'block';
                        
                        // Show specific payment elements
                        if (method.value === 'bit') {
                            document.getElementById('bit-qr').style.display = 'block';
                        } else if (method.value === 'paybox') {
                            document.getElementById('paybox-link').style.display = 'block';
                        }
                    }
                    
                    // Enable complete button
                    completeBtn.disabled = false;
                    
                    // Show confirmation section
                    document.getElementById('payment-confirmation').style.display = 'block';
                    
                    // Update button text based on payment method
                    updateCompleteButtonText(method.value);
                });
            });
        }

        function updateCompleteButtonText(paymentMethod) {
            const btn = document.getElementById('complete-order-btn');
            const total = orderDetails.totals.final.toFixed(2);
            
            switch (paymentMethod) {
                case 'cash':
                    btn.textContent = `×”×©×œ× ×”×–×× ×” - ×ª×©×œ×•× ×‘××–×•××Ÿ (â‚ª${total})`;
                    break;
                case 'bit':
                    btn.textContent = `×”××©×š ×œ×ª×©×œ×•× Bit (â‚ª${total})`;
                    break;
                case 'paybox':
                    btn.textContent = `×”××©×š ×œ×ª×©×œ×•× PayBox (â‚ª${total})`;
                    break;
                default:
                    btn.textContent = '×”×©×œ× ×”×–×× ×”';
            }
        }

        function populateOrderSummary() {
            populateCustomerSummary();
            populateOrderItems();
            populateTotals();
            populateDeliveryDetails();
            
            if (orderDetails.isVIP) {
                document.getElementById('vip-summary').style.display = 'block';
            }
        }

        function populateCustomerSummary() {
            const container = document.getElementById('customer-summary');
            const customer = orderDetails.customer;
            const delivery = orderDetails.delivery;
            
            container.innerHTML = `
                <div class="summary-section">
                    <h4>ğŸ‘¤ ×¤×¨×˜×™ ×œ×§×•×—</h4>
                    <p><strong>${customer.name}</strong></p>
                    <p>ğŸ“ ${customer.phone}</p>
                    ${customer.email ? `<p>ğŸ“§ ${customer.email}</p>` : ''}
                    ${delivery.method === 'delivery' ? `
                        <p>ğŸ  ${customer.address}</p>
                        <p>ğŸšš ××©×œ×•×— ×œ${getZoneName(delivery.zone)}</p>
                    ` : `
                        <p>ğŸª ××™×¡×•×£ ×¢×¦××™ ××”××˜×‘×—</p>
                    `}
                    ${delivery.time ? `<p>â° ×–××Ÿ ××•×¢×“×£: ${delivery.time}</p>` : ''}
                    ${delivery.notes ? `<p>ğŸ“ ×”×¢×¨×•×ª: ${delivery.notes}</p>` : ''}
                </div>
            `;
        }

        function populateOrderItems() {
            const container = document.getElementById('order-items-summary');
            
            container.innerHTML = `
                <div class="summary-section">
                    <h4>ğŸ›’ ×¤×¨×™×˜×™× ×‘×”×–×× ×” (${orderDetails.items.length})</h4>
                    <div class="items-list">
                        ${orderDetails.items.map(item => `
                            <div class="summary-item">
                                <div class="item-name">${item.quantity}x ${item.name_he}</div>
                                <div class="item-price">â‚ª${item.totalPrice.toFixed(2)}</div>
                                ${item.extras && item.extras.length > 0 ? `
                                    <div class="item-extras">+ ${item.extras.map(e => e.name_he).join(', ')}</div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function populateTotals() {
            const totals = orderDetails.totals;
            
            document.getElementById('final-subtotal').textContent = `â‚ª${totals.subtotal.toFixed(2)}`;
            document.getElementById('final-total').textContent = `â‚ª${totals.final.toFixed(2)}`;
            
            if (totals.vipDiscount > 0) {
                document.querySelector('.vip-discount').style.display = 'flex';
                document.getElementById('final-vip-discount').textContent = `-â‚ª${totals.vipDiscount.toFixed(2)}`;
            }
            
            const deliveryLabel = document.getElementById('final-delivery-label');
            const deliveryFee = document.getElementById('final-delivery-fee');
            
            if (orderDetails.delivery.method === 'pickup') {
                deliveryLabel.textContent = '×“××™ ××©×œ×•×—:';
                deliveryFee.textContent = '××™×¡×•×£ ×¢×¦××™';
            } else if (totals.deliveryFee === 0) {
                deliveryLabel.textContent = '×“××™ ××©×œ×•×—:';
                deliveryFee.textContent = '×—×™× ×!';
            } else {
                deliveryLabel.textContent = '×“××™ ××©×œ×•×—:';
                deliveryFee.textContent = `â‚ª${totals.deliveryFee.toFixed(2)}`;
            }
        }

        function populateDeliveryDetails() {
            const container = document.getElementById('delivery-summary');
            const delivery = orderDetails.delivery;
            const estimatedTime = getEstimatedDeliveryTime(delivery);
            
            container.innerHTML = `
                <div class="summary-section">
                    <h4>â° ×–××Ÿ ××¡×¤×§×” ××©×•×¢×¨</h4>
                    <p class="delivery-time">${estimatedTime}</p>
                    <p class="delivery-note">
                        ${delivery.method === 'delivery' ? 
                            'ğŸšš × ×¦×•×¨ ××™×ª×›× ×§×©×¨ ×œ×¤× ×™ ×”××©×œ×•×—' : 
                            'ğŸª × ×•×“×™×¢ ×œ×›× ×›×©×”×”×–×× ×” ××•×›× ×” ×œ××™×¡×•×£'}
                    </p>
                </div>
            `;
        }

        function getZoneName(zone) {
            const zones = {
                'jerusalem': '×™×¨×•×©×œ×™×',
                'mevasseret': '××‘×©×¨×ª ×¦×™×•×Ÿ',
                'surroundings': '×¡×‘×™×‘×•×ª ×™×¨×•×©×œ×™×'
            };
            return zones[zone] || zone;
        }

        function getEstimatedDeliveryTime(delivery) {
            const times = {
                'jerusalem': '45-60 ×“×§×•×ª',
                'mevasseret': '50-65 ×“×§×•×ª',
                'surroundings': '60-75 ×“×§×•×ª'
            };
            
            if (delivery.method === 'pickup') {
                return '15-20 ×“×§×•×ª';
            }
            
            return times[delivery.zone] || '45-60 ×“×§×•×ª';
        }

        function validatePaymentAccess() {
            // Check if restaurant is open
            if (!Utils.isRestaurantOpen()) {
                Utils.showNotification('×”××˜×‘×— ×¡×’×•×¨ ×›×¢×ª. ×”×”×–×× ×” ×ª×˜×•×¤×œ ×‘×¤×ª×™×—×” ×”×‘××”.', 'info');
            }
            
            // Check minimum order (if applicable)
            const minOrder = 30;
            if (orderDetails.totals.subtotal < minOrder) {
                Utils.showNotification(`×”×–×× ×” ××™× ×™××œ×™×ª: â‚ª${minOrder}`, 'error');
                setTimeout(() => window.location.href = 'cart.html', 3000);
            }
        }

        async function processPayment() {
            const selectedMethod = document.querySelector('input[name="payment-method"]:checked');
            if (!selectedMethod) {
                Utils.showNotification('×× × ×‘×—×¨×• ×××¦×¢×™ ×ª×©×œ×•×', 'error');
                return;
            }

            // Show processing modal
            showProcessingModal();
            
            try {
                const paymentData = {
                    ...orderDetails,
                    paymentMethod: selectedMethod.value,
                    orderNumber: generateOrderNumber(),
                    timestamp: new Date().toISOString()
                };

                // Process payment based on method
                await processPaymentMethod(selectedMethod.value, paymentData);
                
                // Send order via WhatsApp and Email
                await sendOrderNotifications(paymentData);
                
                // Save order and clear cart
                await completeOrder(paymentData);
                
                // Redirect to thank you page
                Utils.saveToStorage('completedOrder', paymentData);
                window.location.href = 'thankyou.html';
                
            } catch (error) {
                console.error('Payment processing error:', error);
                Utils.showNotification('×©×’×™××” ×‘×¢×™×‘×•×“ ×”×ª×©×œ×•×. ×× × × ×¡×• ×©×•×‘.', 'error');
                hideProcessingModal();
            }
        }

        async function processPaymentMethod(method, orderData) {
            updateProcessingStep('step-payment', 'â³ ××¢×‘×“ ×ª×©×œ×•×...');
            
            switch (method) {
                case 'cash':
                    // Cash payment - no processing needed
                    await delay(1000);
                    updateProcessingStep('step-payment', 'âœ… ×ª×©×œ×•× ×‘××–×•××Ÿ × ×¨×©×');
                    break;
                    
                case 'bit':
                    // Open Bit payment
                    const bitUrl = `https://www.bitpay.co.il/app/me/C822FDFE-1C69-4F92-B57B-09635D465B9D?amount=${orderData.totals.final}&description=××˜×‘×— ×œ×•×œ×• ×”×–×× ×” ${orderData.orderNumber}`;
                    window.open(bitUrl, '_blank');
                    await delay(2000);
                    updateProcessingStep('step-payment', 'âœ… ×”×•×¤× ×” ×œ×ª×©×œ×•× Bit');
                    break;
                    
                case 'paybox':
                    // Open PayBox payment
                    const payboxUrl = `https://link.payboxapp.com/Hh5KZaqQc1Jz93Zv7`;
                    window.open(payboxUrl, '_blank');
                    await delay(2000);
                    updateProcessingStep('step-payment', 'âœ… ×”×•×¤× ×” ×œ×ª×©×œ×•× PayBox');
                    break;
            }
        }

        async function sendOrderNotifications(orderData) {
            updateProcessingStep('step-confirm', 'â³ ×©×•×œ×— ×”×–×× ×”...');
            
            try {
                // Send WhatsApp message
                Utils.sendWhatsAppOrder({
                    ...orderData,
                    customerName: orderData.customer.name,
                    customerPhone: orderData.customer.phone,
                    customerAddress: orderData.customer.address,
                    deliveryTime: orderData.delivery.time,
                    notes: orderData.delivery.notes,
                    paymentMethod: getPaymentMethodName(orderData.paymentMethod),
                    items: orderData.items,
                    subtotal: orderData.totals.subtotal,
                    total: orderData.totals.final,
                    deliveryFee: orderData.totals.deliveryFee,
                    isVIP: orderData.isVIP
                });
                
                // Send email if provided
                if (orderData.customer.email) {
                    Utils.sendEmailOrder({
                        ...orderData,
                        customerName: orderData.customer.name,
                        customerEmail: orderData.customer.email,
                        items: orderData.items,
                        total: orderData.totals.final
                    });
                }
                
                updateProcessingStep('step-confirm', 'âœ… ×”×–×× ×” × ×©×œ×—×”');
                
            } catch (error) {
                console.error('Error sending notifications:', error);
                updateProcessingStep('step-confirm', 'âš ï¸ ×©×’×™××” ×‘×©×œ×™×—×” - ×”×”×–×× ×” × ×©××¨×”');
            }
        }

        async function completeOrder(orderData) {
            updateProcessingStep('step-complete', 'â³ ××©×œ×™× ×”×–×× ×”...');
            
            // Save order to customer history
            if (window.cartManager) {
                cartManager.saveOrder(orderData);
            }
            
            // Clear cart
            Utils.removeFromStorage('luluCart');
            Utils.removeFromStorage('checkoutCart');
            Utils.removeFromStorage('orderDetails');
            
            // Add loyalty points
            const points = Math.floor(orderData.totals.final);
            const currentPoints = Utils.loadFromStorage('luluPoints', 0);
            Utils.saveToStorage('luluPoints', currentPoints + points);
            
            // Activate VIP if selected
            if (orderData.isVIP) {
                Utils.saveToStorage('luluVIP', true);
            }
            
            // Track purchase
            Utils.trackPurchase(orderData);
            
            updateProcessingStep('step-complete', 'âœ… ×”×–×× ×” ×”×•×©×œ××”!');
            
            await delay(1000);
        }

        function generateOrderNumber() {
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `${year}${month}${day}${random}`;
        }

        function getPaymentMethodName(method) {
            const names = {
                'cash': '××–×•××Ÿ',
                'bit': 'Bit',
                'paybox': 'PayBox'
            };
            return names[method] || method;
        }

        function showProcessingModal() {
            document.getElementById('payment-processing-modal').style.display = 'block';
        }

        function hideProcessingModal() {
            document.getElementById('payment-processing-modal').style.display = 'none';
        }

        function updateProcessingStep(stepId, text) {
            const step = document.getElementById(stepId);
            if (step) {
                step.textContent = text;
                if (text.startsWith('âœ…')) {
                    step.style.color = 'var(--primary-gold)';
                }
            }
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function goBackToOrder() {
            window.location.href = 'order.html';
        }
    </script>
</body>
</html>