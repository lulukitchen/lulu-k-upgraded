<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×•×“×” ×¢×œ ×”×”×–×× ×”! - ××˜×‘×— ×œ×•×œ×•</title>
    <meta name="description" content="×”×”×–×× ×” ×©×œ×›× ×”×ª×§×‘×œ×” ×‘×”×¦×œ×—×” - ××˜×‘×— ×œ×•×œ×•">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
</head>
<body>
    <!-- Header -->
    <header id="header">
        <div class="container">
            <div class="logo">
                <h1>ğŸœ ××˜×‘×— ×œ×•×œ×•</h1>
                <span>×”××˜×‘×— ×”×¡×™× ×™ ×”×˜×•×‘ ×‘×™×¨×•×©×œ×™×</span>
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="index.html">×‘×™×ª</a></li>
                    <li><a href="menu.html">×”×ª×¤×¨×™×˜</a></li>
                    <li><a href="about.html">××•×“×•×ª</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Thank You Section -->
    <section class="thankyou-section">
        <div class="container">
            <div class="thankyou-content">
                <!-- Success Message -->
                <div class="success-message">
                    <div class="success-icon">ğŸ‰</div>
                    <h1>×ª×•×“×” ×¨×‘×” ×¢×œ ×”×”×–×× ×”!</h1>
                    <p class="success-subtitle">×”×”×–×× ×” ×©×œ×›× ×”×ª×§×‘×œ×” ×‘×”×¦×œ×—×” ×•× ××¦××ª ×‘×˜×™×¤×•×œ</p>
                </div>

                <!-- Order Details Card -->
                <div class="order-confirmation-card">
                    <div class="confirmation-header">
                        <h2>ğŸ“‹ ××™×©×•×¨ ×”×–×× ×”</h2>
                        <div class="order-number" id="order-number">
                            <span class="label">××¡×¤×¨ ×”×–×× ×”:</span>
                            <span class="number">#000000</span>
                        </div>
                        <div class="order-date" id="order-date">
                            <span class="label">×ª××¨×™×š:</span>
                            <span class="date"></span>
                        </div>
                    </div>

                    <div class="confirmation-content">
                        <!-- Customer Info -->
                        <div class="confirmation-section">
                            <h3>ğŸ‘¤ ×¤×¨×˜×™ ×œ×§×•×—</h3>
                            <div class="customer-info" id="customer-info">
                                <!-- Customer details will be populated here -->
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="confirmation-section">
                            <h3>ğŸ›’ ×¤×¨×˜×™ ×”×”×–×× ×”</h3>
                            <div class="order-items" id="order-items-confirmation">
                                <!-- Order items will be populated here -->
                            </div>
                            
                            <div class="order-totals-confirmation">
                                <div class="total-line">
                                    <span>×¡×›×•× ×¤×¨×™×˜×™×:</span>
                                    <span id="confirm-subtotal">â‚ª0.00</span>
                                </div>
                                <div class="total-line vip-discount" style="display:none;">
                                    <span>×”× ×—×ª VIP (15%):</span>
                                    <span id="confirm-vip-discount">-â‚ª0.00</span>
                                </div>
                                <div class="total-line">
                                    <span>×“××™ ××©×œ×•×—:</span>
                                    <span id="confirm-delivery-fee">â‚ª0.00</span>
                                </div>
                                <div class="total-line final">
                                    <span><strong>×¡×”"×› ×©×•×œ×:</strong></span>
                                    <span id="confirm-total"><strong>â‚ª0.00</strong></span>
                                </div>
                            </div>
                        </div>

                        <!-- Delivery Info -->
                        <div class="confirmation-section">
                            <h3 id="delivery-title">ğŸšš ×¤×¨×˜×™ ××©×œ×•×—</h3>
                            <div class="delivery-info" id="delivery-info">
                                <!-- Delivery details will be populated here -->
                            </div>
                        </div>

                        <!-- Payment Info -->
                        <div class="confirmation-section">
                            <h3>ğŸ’³ ×¤×¨×˜×™ ×ª×©×œ×•×</h3>
                            <div class="payment-info" id="payment-info">
                                <!-- Payment details will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="next-steps">
                    <h2>ğŸ“± ××” ×§×•×¨×” ×¢×›×©×™×•?</h2>
                    <div class="steps-timeline">
                        <div class="step completed">
                            <div class="step-icon">âœ…</div>
                            <div class="step-content">
                                <h4>×”×–×× ×” ×”×ª×§×‘×œ×”</h4>
                                <p>×”×”×–×× ×” ×©×œ×›× × ×¨×©××” ×‘××¢×¨×›×ª</p>
                            </div>
                        </div>
                        <div class="step active">
                            <div class="step-icon">ğŸ‘¨â€ğŸ³</div>
                            <div class="step-content">
                                <h4>×”×›× ×ª ×”×× ×•×ª</h4>
                                <p>×”×¦×•×•×ª ×©×œ× ×• ××›×™×Ÿ ××ª ×”×× ×•×ª ×”×˜×¨×™×•×ª</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-icon">ğŸšš</div>
                            <div class="step-content">
                                <h4 id="final-step-title">××©×œ×•×—</h4>
                                <p id="final-step-desc">×”×× ×•×ª ×™×’×™×¢×• ××œ×™×›× ×—××•×ª ×•×˜×¢×™××•×ª</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact and Tracking -->
                <div class="order-tracking">
                    <div class="tracking-section">
                        <h3>ğŸ“ ×¢×§×™×‘×” ×•×§×©×¨</h3>
                        <div class="tracking-info">
                            <div class="contact-item">
                                <div class="contact-icon">ğŸ“±</div>
                                <div class="contact-details">
                                    <h4>WhatsApp</h4>
                                    <p>×§×™×‘×œ×ª× ×”×•×“×¢×” ×‘-WhatsApp ×¢× ×¤×¨×˜×™ ×”×”×–×× ×”</p>
                                    <a href="https://wa.me/972525201978" class="btn-secondary">×¤×ª×— WhatsApp</a>
                                </div>
                            </div>
                            <div class="contact-item" id="email-confirmation" style="display:none;">
                                <div class="contact-icon">ğŸ“§</div>
                                <div class="contact-details">
                                    <h4>××™×©×•×¨ ×‘×“×•×"×œ</h4>
                                    <p>××™×©×•×¨ ×”×”×–×× ×” × ×©×œ×— ×œ×›×ª×•×‘×ª ×”××™×™×œ ×©×œ×›×</p>
                                </div>
                            </div>
                            <div class="contact-item">
                                <div class="contact-icon">â˜ï¸</div>
                                <div class="contact-details">
                                    <h4>×©×™×¨×•×ª ×œ×§×•×—×•×ª</h4>
                                    <p>×œ×›×œ ×©××œ×” ××• ×‘×¢×™×”</p>
                                    <a href="tel:052-520-1978" class="btn-secondary">052-520-1978</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIP Welcome -->
                <div class="vip-welcome" id="vip-welcome" style="display:none;">
                    <div class="vip-card">
                        <h2>ğŸ‘‘ ×‘×¨×•×›×™× ×”×‘××™× ×œ××•×¢×“×•×Ÿ VIP!</h2>
                        <p>×”×¦×˜×¨×¤×ª× ×‘×”×¦×œ×—×” ×œ××•×¢×“×•×Ÿ ×”-VIP ×©×œ× ×•</p>
                        <div class="vip-benefits">
                            <div class="benefit-item">
                                <span class="benefit-icon">ğŸ’°</span>
                                <span>15% ×”× ×—×” ×¢×œ ×›×œ ×”×–×× ×”</span>
                            </div>
                            <div class="benefit-item">
                                <span class="benefit-icon">ğŸšš</span>
                                <span>××©×œ×•×— ×—×™× × ×ª××™×“</span>
                            </div>
                            <div class="benefit-item">
                                <span class="benefit-icon">â­</span>
                                <span>× ×§×•×“×•×ª ×œ×•×™××œ×™×˜×™ ×›×¤×•×œ×•×ª</span>
                            </div>
                            <div class="benefit-item">
                                <span class="benefit-icon">ğŸ½ï¸</span>
                                <span>×’×™×©×” ×œ×× ×•×ª ×‘×œ×¢×“×™×•×ª</span>
                            </div>
                        </div>
                        <p class="vip-note">×”×”×˜×‘×•×ª ×™×•×¤×¢×œ×• ××”×”×–×× ×” ×”×‘××”</p>
                    </div>
                </div>

                <!-- Loyalty Points -->
                <div class="loyalty-earned" id="loyalty-earned">
                    <div class="points-card">
                        <h3>ğŸŒŸ × ×§×•×“×•×ª ×œ×•×™××œ×™×˜×™</h3>
                        <div class="points-earned">
                            <span class="points-number" id="points-earned-count">0</span>
                            <span class="points-text">× ×§×•×“×•×ª × ×¦×‘×¨×•</span>
                        </div>
                        <p class="points-info">100 × ×§×•×“×•×ª = â‚ª10 ×”× ×—×” ×‘×”×–×× ×” ×”×‘××”</p>
                        <div class="total-points">
                            <span>×¡×”"×› × ×§×•×“×•×ª ×©×œ×›×: <strong id="total-points-count">0</strong></span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <a href="menu.html" class="btn-primary">×”×–××™× ×• ×©×•×‘</a>
                    <a href="index.html" class="btn-secondary">×—×–×¨×” ×œ×‘×™×ª</a>
                    <button onclick="shareOrder()" class="btn-secondary">×©×ª×¤×• ×—×‘×¨×™×</button>
                </div>

                <!-- Feedback Section -->
                <div class="feedback-section">
                    <h3>ğŸ’­ ××™×š ×”×™×™× ×•?</h3>
                    <p>×”××©×•×‘ ×©×œ×›× ×—×©×•×‘ ×œ× ×•!</p>
                    <div class="feedback-buttons">
                        <button onclick="leaveFeedback(5)" class="feedback-btn">ğŸ¤© ××¢×•×œ×”</button>
                        <button onclick="leaveFeedback(4)" class="feedback-btn">ğŸ˜Š ×˜×•×‘</button>
                        <button onclick="leaveFeedback(3)" class="feedback-btn">ğŸ˜ ×‘×¡×“×¨</button>
                        <button onclick="leaveFeedback(2)" class="feedback-btn">ğŸ˜ ×œ× ×˜×•×‘</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 ××˜×‘×— ×œ×•×œ×• - ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</p>
            <p>× ×‘× ×” ×¢× â¤ï¸ ×‘×™×¨×•×©×œ×™×</p>
        </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/main.js"></script>
    <script>
        let completedOrder = {};
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeThankYouPage();
        });

        function initializeThankYouPage() {
            loadCompletedOrder();
            populateOrderDetails();
            setupAutoRedirect();
            trackPageView();
        }

        function loadCompletedOrder() {
            completedOrder = Utils.loadFromStorage('completedOrder', null);
            
            if (!completedOrder) {
                // No completed order found, redirect to home
                Utils.showNotification('×œ× × ××¦××• ×¤×¨×˜×™ ×”×–×× ×”', 'error');
                setTimeout(() => window.location.href = 'index.html', 2000);
                return;
            }
        }

        function populateOrderDetails() {
            populateOrderHeader();
            populateCustomerInfo();
            populateOrderItems();
            populateDeliveryInfo();
            populatePaymentInfo();
            populateLoyaltyPoints();
            
            if (completedOrder.isVIP) {
                document.getElementById('vip-welcome').style.display = 'block';
            }
            
            if (completedOrder.customer.email) {
                document.getElementById('email-confirmation').style.display = 'block';
            }
        }

        function populateOrderHeader() {
            document.getElementById('order-number').querySelector('.number').textContent = `#${completedOrder.orderNumber}`;
            document.getElementById('order-date').querySelector('.date').textContent = 
                new Date(completedOrder.timestamp).toLocaleString('he-IL');
        }

        function populateCustomerInfo() {
            const container = document.getElementById('customer-info');
            const customer = completedOrder.customer;
            
            container.innerHTML = `
                <div class="info-item">
                    <span class="label">×©×:</span>
                    <span class="value">${customer.name}</span>
                </div>
                <div class="info-item">
                    <span class="label">×˜×œ×¤×•×Ÿ:</span>
                    <span class="value">${customer.phone}</span>
                </div>
                ${customer.email ? `
                    <div class="info-item">
                        <span class="label">××™××™×™×œ:</span>
                        <span class="value">${customer.email}</span>
                    </div>
                ` : ''}
            `;
        }

        function populateOrderItems() {
            const container = document.getElementById('order-items-confirmation');
            
            container.innerHTML = completedOrder.items.map(item => `
                <div class="order-item-row">
                    <div class="item-details">
                        <span class="item-name">${item.quantity}x ${item.name_he}</span>
                        ${item.extras && item.extras.length > 0 ? `
                            <div class="item-extras">×ª×•×¡×¤×•×ª: ${item.extras.map(e => e.name_he).join(', ')}</div>
                        ` : ''}
                    </div>
                    <div class="item-price">â‚ª${item.totalPrice.toFixed(2)}</div>
                </div>
            `).join('');
            
            // Populate totals
            const totals = completedOrder.totals;
            document.getElementById('confirm-subtotal').textContent = `â‚ª${totals.subtotal.toFixed(2)}`;
            document.getElementById('confirm-total').textContent = `â‚ª${totals.final.toFixed(2)}`;
            
            if (totals.vipDiscount > 0) {
                document.querySelector('.vip-discount').style.display = 'flex';
                document.getElementById('confirm-vip-discount').textContent = `-â‚ª${totals.vipDiscount.toFixed(2)}`;
            }
            
            const deliveryFeeEl = document.getElementById('confirm-delivery-fee');
            if (totals.deliveryFee === 0) {
                deliveryFeeEl.textContent = '×—×™× ×!';
            } else {
                deliveryFeeEl.textContent = `â‚ª${totals.deliveryFee.toFixed(2)}`;
            }
        }

        function populateDeliveryInfo() {
            const container = document.getElementById('delivery-info');
            const delivery = completedOrder.delivery;
            const customer = completedOrder.customer;
            
            if (delivery.method === 'pickup') {
                document.getElementById('delivery-title').innerHTML = 'ğŸª ×¤×¨×˜×™ ××™×¡×•×£';
                document.getElementById('final-step-title').textContent = '××™×¡×•×£ ×¢×¦××™';
                document.getElementById('final-step-desc').textContent = '×”×”×–×× ×” ×ª×”×™×” ××•×›× ×” ×œ××™×¡×•×£';
                
                container.innerHTML = `
                    <div class="info-item">
                        <span class="label">×¡×•×’ ××™×¡×•×£:</span>
                        <span class="value">××™×¡×•×£ ×¢×¦××™ ××”××˜×‘×—</span>
                    </div>
                    <div class="info-item">
                        <span class="label">×›×ª×•×‘×ª:</span>
                        <span class="value">××˜×‘×— ×œ×•×œ×•, ×™×¨×•×©×œ×™×</span>
                    </div>
                    <div class="info-item">
                        <span class="label">×–××Ÿ ××™×¡×•×£ ××©×•×¢×¨:</span>
                        <span class="value">15-20 ×“×§×•×ª</span>
                    </div>
                    ${delivery.time ? `
                        <div class="info-item">
                            <span class="label">×–××Ÿ ××•×¢×“×£:</span>
                            <span class="value">${delivery.time}</span>
                        </div>
                    ` : ''}
                    <div class="pickup-note">
                        ğŸ“ × ×•×“×™×¢ ×œ×›× ×›×©×”×”×–×× ×” ××•×›× ×” ×œ××™×¡×•×£
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="info-item">
                        <span class="label">×›×ª×•×‘×ª ××©×œ×•×—:</span>
                        <span class="value">${customer.address}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">××–×•×¨ ××©×œ×•×—:</span>
                        <span class="value">${getZoneName(delivery.zone)}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">×–××Ÿ ××©×œ×•×— ××©×•×¢×¨:</span>
                        <span class="value">${getDeliveryTime(delivery.zone)}</span>
                    </div>
                    ${delivery.time ? `
                        <div class="info-item">
                            <span class="label">×–××Ÿ ××•×¢×“×£:</span>
                            <span class="value">${delivery.time}</span>
                        </div>
                    ` : ''}
                    ${delivery.notes ? `
                        <div class="info-item">
                            <span class="label">×”×¢×¨×•×ª:</span>
                            <span class="value">${delivery.notes}</span>
                        </div>
                    ` : ''}
                    <div class="delivery-note">
                        ğŸ“ × ×¦×•×¨ ××™×ª×›× ×§×©×¨ ×œ×¤× ×™ ×”××©×œ×•×—
                    </div>
                `;
            }
        }

        function populatePaymentInfo() {
            const container = document.getElementById('payment-info');
            const paymentMethodName = getPaymentMethodName(completedOrder.paymentMethod);
            
            container.innerHTML = `
                <div class="info-item">
                    <span class="label">×××¦×¢×™ ×ª×©×œ×•×:</span>
                    <span class="value">${paymentMethodName}</span>
                </div>
                <div class="info-item">
                    <span class="label">×¡×›×•× ×©×•×œ×:</span>
                    <span class="value strong">â‚ª${completedOrder.totals.final.toFixed(2)}</span>
                </div>
                <div class="info-item">
                    <span class="label">×¡×˜×˜×•×¡ ×ª×©×œ×•×:</span>
                    <span class="value success">
                        ${completedOrder.paymentMethod === 'cash' ? '×××ª×™×Ÿ ×œ×ª×©×œ×•×' : '×©×•×œ×'}
                    </span>
                </div>
            `;
        }

        function populateLoyaltyPoints() {
            const pointsEarned = Math.floor(completedOrder.totals.final);
            const currentPoints = Utils.loadFromStorage('luluPoints', 0);
            
            document.getElementById('points-earned-count').textContent = pointsEarned;
            document.getElementById('total-points-count').textContent = currentPoints;
            
            if (completedOrder.isVIP) {
                // VIP gets double points
                document.getElementById('points-earned-count').textContent = pointsEarned * 2;
                const vipNote = document.createElement('p');
                vipNote.className = 'vip-points-note';
                vipNote.textContent = 'ğŸ‘‘ × ×§×•×“×•×ª ×›×¤×•×œ×•×ª ×‘×–×›×•×ª ××¢××“ VIP!';
                document.querySelector('.points-card').appendChild(vipNote);
            }
        }

        function getZoneName(zone) {
            const zones = {
                'jerusalem': '×™×¨×•×©×œ×™×',
                'mevasseret': '××‘×©×¨×ª ×¦×™×•×Ÿ',
                'surroundings': '×¡×‘×™×‘×•×ª ×™×¨×•×©×œ×™×'
            };
            return zones[zone] || zone;
        }

        function getDeliveryTime(zone) {
            const times = {
                'jerusalem': '45-60 ×“×§×•×ª',
                'mevasseret': '50-65 ×“×§×•×ª',
                'surroundings': '60-75 ×“×§×•×ª'
            };
            return times[zone] || '45-60 ×“×§×•×ª';
        }

        function getPaymentMethodName(method) {
            const names = {
                'cash': '××–×•××Ÿ',
                'bit': 'Bit',
                'paybox': 'PayBox'
            };
            return names[method] || method;
        }

        function setupAutoRedirect() {
            // Optional: Auto-redirect to home after a long time
            // setTimeout(() => {
            //     window.location.href = 'index.html';
            // }, 300000); // 5 minutes
        }

        function trackPageView() {
            Utils.trackEvent('order_complete', {
                order_id: completedOrder.orderNumber,
                order_value: completedOrder.totals.final,
                payment_method: completedOrder.paymentMethod,
                delivery_method: completedOrder.delivery.method,
                is_vip: completedOrder.isVIP
            });
        }

        function shareOrder() {
            if (navigator.share) {
                navigator.share({
                    title: '×”×–×× ×ª×™ ×××˜×‘×— ×œ×•×œ×•!',
                    text: '×”×–×× ×ª×™ ××”××˜×‘×— ×”×¡×™× ×™ ×”×˜×•×‘ ×‘×™×¨×•×©×œ×™× - ××˜×‘×— ×œ×•×œ×•',
                    url: window.location.origin
                });
            } else {
                // Fallback for browsers without Web Share API
                const shareText = `×”×–×× ×ª×™ ×××˜×‘×— ×œ×•×œ×•! ×”××˜×‘×— ×”×¡×™× ×™ ×”×˜×•×‘ ×‘×™×¨×•×©×œ×™×\n${window.location.origin}`;
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(shareText);
                    Utils.showNotification('×”×§×™×©×•×¨ ×”×•×¢×ª×§ ×œ×œ×•×—', 'success');
                }
            }
        }

        function leaveFeedback(rating) {
            const feedback = {
                orderNumber: completedOrder.orderNumber,
                rating: rating,
                timestamp: new Date().toISOString()
            };
            
            // Save feedback (would normally send to server)
            const existingFeedback = Utils.loadFromStorage('luluFeedback', []);
            existingFeedback.push(feedback);
            Utils.saveToStorage('luluFeedback', existingFeedback);
            
            // Show thank you message
            const ratingTexts = {
                5: '×ª×•×“×” ×¨×‘×”! ğŸ¤©',
                4: '×ª×•×“×” ×¢×œ ×”××©×•×‘! ğŸ˜Š',
                3: '× ×©××— ×œ×©×¤×¨! ğŸ˜',
                2: '× ×¦×•×¨ ××™×ª×›× ×§×©×¨ ×œ×©×™×¤×•×¨ ğŸ˜'
            };
            
            Utils.showNotification(ratingTexts[rating], 'success');
            
            // Hide feedback section after rating
            document.querySelector('.feedback-section').style.display = 'none';
            
            // Track feedback
            Utils.trackEvent('feedback_given', {
                order_id: completedOrder.orderNumber,
                rating: rating
            });
        }

        // Clean up stored order data after page load
        setTimeout(() => {
            Utils.removeFromStorage('completedOrder');
        }, 5000);
    </script>
</body>
</html>